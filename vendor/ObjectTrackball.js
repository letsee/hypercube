!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.ObjectTrackball=e():t.ObjectTrackball=e()}(this,function(){return function(t){function e(n){if(o[n])return o[n].exports;var c=o[n]={i:n,l:!1,exports:{}};return t[n].call(c.exports,c,c.exports,e),c.l=!0,c.exports}var o={};return e.m=t,e.c=o,e.i=function(t){return t},e.d=function(t,o,n){e.o(t,o)||Object.defineProperty(t,o,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var o=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(o,"a",o),o},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=0)}([function(t,e){function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var n,c=function(){function t(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,o,n){return o&&t(e.prototype,o),n&&t(e,n),e}}(),r=function(){function t(e,c){o(this,t),this.model=e,this.speed=c.speed,this.touch={on:!1,pointer:{rotate:{start:new Vector3(0,0,1),end:new Vector3(0,0,1)},start:{x:0,y:0}},quaternion:null,window:{fx:window.innerWidth/2,fy:window.innerHeight/2},speed:this.speed,time:{lastMove:0,release:50},delta:{x:0,y:0},pinch:{on:!1,dist:0}},n=this}return c(t,[{key:"load",value:function(){Letsee.addEventListener("trackmove",this.thread),document.addEventListener("touchstart",this.touchDown)}},{key:"touchDown",value:function(t){2===t.touches.length&&(n.touch.pinch.on=!0),document.addEventListener("touchmove",n.touchMove),document.addEventListener("touchend",n.touchUp),n.touch.on=!0,n.touch.pointer.start={x:t.touches[0].screenX,y:t.touches[0].screenY},n.touch.pointer.rotate.start=n.touch.pointer.rotate.end=n.touchControl(0,0)}},{key:"touchMove",value:function(t){n.touch.pinch.on?n.touch.pinch.dist=Math.sqrt((t.touches[0].screenX-t.touches[1].screenX)*(t.touches[0].screenX-t.touches[1].screenX)+(t.touches[0].screenY-t.touches[1].screenY)*(t.touches[0].screenY-t.touches[1].screenY)):(n.touch.delta.x=t.touches[0].screenX-n.touch.pointer.start.x,n.touch.delta.y=t.touches[0].screenY-n.touch.pointer.start.y,n.handler(),n.touch.pointer.start.x=t.touches[0].screenX,n.touch.pointer.start.y=t.touches[0].screenY,n.touch.time.lastMove=new Date)}},{key:"touchUp",value:function(t){n.touch.pinch.on?setTimeout(function(){n.touch.pinch.on=!1},100):((new Date).getTime()-n.touch.time.lastMove.getTime()>n.touch.time.release&&(n.touch.delta.x=t.touches[0].screenX-n.touch.pointer.start.x,n.touch.delta.y=t.touches[0].screenY-n.touch.pointer.start.y),n.touch.on=!1),document.removeEventListener("touchmove",n.touchMove),document.removeEventListener("touchend",n.touchUp)}},{key:"touchControl",value:function(t,e){var o=new Vector3;o.set(Math.min(Math.max(t/this.touch.window.fx,-1),1),Math.min(Math.max(-e/this.touch.window.fy,-1),1),0);var n=o.length();return n>1?o.normalize():o.z=Math.sqrt(1-n*n),o}},{key:"rotateObject",value:function(t,e){var o=new Vector3,n=new Quaternion,c=Math.acos(t.dot(e)/t.length()/e.length());return c&&(o.crossVectors(t,e).normalize(),c*=this.touch.speed,n.setFromAxisAngle(o,c)),n}},{key:"thread",value:function(){n.touch.on||(n.touch.delta.x<-.05||n.touch.delta.x>.05?n.touch.delta.x*=.95:n.touch.delta.x=0,n.touch.delta.y<-.05||n.touch.delta.y>.05?n.touch.delta.y*=.95:n.touch.delta.y=0,n.handler())}},{key:"handler",value:function(){this.touch.pointer.rotate.end=this.touchControl(this.touch.delta.x,this.touch.delta.y);var t=this.rotateObject(this.touch.pointer.rotate.start,this.touch.pointer.rotate.end);this.touch.quaternion=this.model.quaternion,this.touch.quaternion.multiplyQuaternions(t,this.touch.quaternion),this.touch.quaternion.normalize(),this.model.quaternion.copy(this.touch.quaternion),this.touch.pointer.rotate.end=this.touch.pointer.rotate.start}},{key:"getPinchDist",value:function(){return this.touch.pinch.dist}},{key:"isPinch",value:function(){return this.touch.pinch.on}}]),t}();t.exports=r}])});
